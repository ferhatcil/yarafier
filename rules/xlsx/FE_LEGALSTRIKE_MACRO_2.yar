rule FE_LEGALSTRIKE_MACRO_2{meta:version=".1"        filetype="MACRO"        author="Ian.Ahl@fireeye.com @TekDefense"        date="2017-06-02"        description="This rule was written to hit on specific variables and powershell command fragments as seen in the macro found in the XLSX file3a1dca21bfe72368f2dd46eb4d9b48c4." strings:        // Setting the environment        $env1 = "Arch = Environ(\"PROCESSOR_ARCHITECTURE\")" ascii wide        $env2 = "windir = Environ(\"windir\")" ascii wide        $env3 = "windir + \"\\syswow64\\windowspowershell\\v1.0\\powershell.exe\"" ascii wide        // powershell command fragments        $ps1 = "-NoP" ascii wide        $ps2 = "-NonI" ascii wide        $ps3 = "-W Hidden" ascii wide        $ps4 = "-Command" ascii wide        $ps5 = "New-Object IO.StreamReader" ascii wide        $ps6 = "IO.Compression.DeflateStream" ascii wide        $ps7 = "IO.MemoryStream" ascii wide        $ps8 = ",$([Convert]::FromBase64String" ascii wide        $ps9 = "ReadToEnd();" ascii wide        $psregex1 = /\W\w+\s+\s\".+\"/ condition:        (               (                       (uint16(0) != 0x5A4D)               )               and               (                       all of ($env*) and 6 of ($ps*)                       or                       all of ($env*) and 4 of ($ps*) and all of ($psregex*)               )        )}